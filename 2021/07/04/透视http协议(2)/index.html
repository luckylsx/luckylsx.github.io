<!DOCTYPE html><html lang="en.yml"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="format-detection" content="telephone=no"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><link rel="icon" href="/images/icons/favicon-16x16.png?v=2.6.2" type="image/png" sizes="16x16"><link rel="icon" href="/images/icons/favicon-32x32.png?v=2.6.2" type="image/png" sizes="32x32"><meta name="description" content="键入网址再按下回车，发生了什么？                           使用 IP 地址访问 Web 服务器        浏览器从地址栏的输入中获得服务器的IP 地址和端口号； 浏览器用 TCP 的三次握手与服务器建立连接；">
<meta property="og:type" content="article">
<meta property="og:title" content="透视http协议(2)">
<meta property="og:url" content="http://example.com/2021/07/04/%E9%80%8F%E8%A7%86http%E5%8D%8F%E8%AE%AE(2)/index.html">
<meta property="og:site_name" content="Study hard, Work Hard">
<meta property="og:description" content="键入网址再按下回车，发生了什么？                           使用 IP 地址访问 Web 服务器        浏览器从地址栏的输入中获得服务器的IP 地址和端口号； 浏览器用 TCP 的三次握手与服务器建立连接；">
<meta property="og:locale">
<meta property="og:image" content="http://example.com/images/http/gk/tcp-header.webp">
<meta property="og:image" content="http://example.com/images/http/gk/http-header.webp">
<meta property="og:image" content="http://example.com/images/http/gk/http-header-code.webp">
<meta property="og:image" content="http://example.com/images/http/gk/request-line.webp">
<meta property="og:image" content="http://example.com/images/http/gk/status-line.webp">
<meta property="og:image" content="http://example.com/images/http/gk/request-h.webp">
<meta property="og:image" content="http://example.com/images/http/gk/response-h.webp">
<meta property="og:image" content="http://example.com/images/http/gk/github-server.webp">
<meta property="og:image" content="http://example.com/images/http/gk/uri-formation.webp">
<meta property="og:image" content="http://example.com/images/http/gk/uri-full-formation.webp">
<meta property="article:published_time" content="2021-07-03T16:00:00.000Z">
<meta property="article:modified_time" content="2021-07-04T14:54:07.317Z">
<meta property="article:author" content="lucky">
<meta property="article:tag" content="http">
<meta property="article:tag" content="TCP&#x2F;IP">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/images/http/gk/tcp-header.webp"><title>透视http协议(2) | Study hard, Work Hard</title><link ref="canonical" href="http://example.com/2021/07/04/%E9%80%8F%E8%A7%86http%E5%8D%8F%E8%AE%AE(2)/"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.12.1/css/all.min.css" type="text/css"><link rel="stylesheet" href="/css/index.css?v=2.6.2"><script>var Stun = window.Stun || {};
var CONFIG = {
  root: '/',
  algolia: undefined,
  assistSearch: ["google","bing","baidu"],
  fontIcon: {"prompt":{"success":"fas fa-check-circle","info":"fas fa-arrow-circle-right","warning":"fas fa-exclamation-circle","error":"fas fa-times-circle"},"copyBtn":"fas fa-copy"},
  sidebar: {"offsetTop":"20px","tocMaxDepth":6},
  header: {"enable":true,"showOnPost":true,"scrollDownIcon":false},
  postWidget: {"endText":true},
  nightMode: {"enable":true},
  back2top: {"enable":true},
  codeblock: {"style":"default","highlight":"light","wordWrap":false},
  reward: false,
  fancybox: false,
  zoomImage: {"gapAside":"20px"},
  galleryWaterfall: undefined,
  lazyload: false,
  pjax: undefined,
  externalLink: {"icon":{"enable":true,"name":"fas fa-external-link-alt"}},
  shortcuts: undefined,
  prompt: {"copyButton":"Copy","copySuccess":"Copy Success","copyError":"Copy Error"},
  sourcePath: {"js":"js","css":"css","images":"images"},
};

window.CONFIG = CONFIG;</script><meta name="generator" content="Hexo 5.3.0"></head><body><div class="container" id="container"><header class="header" id="header"><div class="header-inner"><nav class="header-nav header-nav--fixed"><div class="header-nav-inner"><div class="header-nav-menubtn"><i class="fas fa-bars"></i></div><div class="header-nav-menu"><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/"><span class="header-nav-menu-item__icon"><i class="fas fa-home"></i></span><span class="header-nav-menu-item__text">Home</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/archives/"><span class="header-nav-menu-item__icon"><i class="fas fa-folder-open"></i></span><span class="header-nav-menu-item__text">Archives</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/categories/"><span class="header-nav-menu-item__icon"><i class="fas fa-layer-group"></i></span><span class="header-nav-menu-item__text">Categories</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/tags/"><span class="header-nav-menu-item__icon"><i class="fas fa-tags"></i></span><span class="header-nav-menu-item__text">Tags</span></a></div></div><div class="header-nav-search"><span class="header-nav-search__icon"><i class="fas fa-search"></i></span><span class="header-nav-search__text">Search</span></div><div class="header-nav-mode"><div class="mode"><div class="mode-track"><span class="mode-track-moon"></span><span class="mode-track-sun"></span></div><div class="mode-thumb"></div></div></div></div></nav><div class="header-banner"><div class="header-banner-info"><div class="header-banner-info__title">Study hard, Work Hard</div><div class="header-banner-info__subtitle">If you don't want to wasted life in the world, that is about to study for a lifetime.</div></div></div></div></header><main class="main" id="main"><div class="main-inner"><div class="content-wrap" id="content-wrap"><div class="content" id="content"><!-- Just used to judge whether it is an article page--><div id="is-post"></div><div class="post"><header class="post-header"><h1 class="post-title">透视http协议(2)</h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">Created</span><span class="post-meta-item__value">2021-07-04</span></span><span class="post-meta-item post-meta-item--updatetime"><span class="post-meta-item__icon"><i class="far fa-calendar-check"></i></span><span class="post-meta-item__info">Updated</span><span class="post-meta-item__value">2021-07-04</span></span><span class="post-meta-item post-meta-item--visitors"><span class="post-meta-item__icon"><i class="fas fa-eye"></i></span><span class="post-meta-item__info">Visited</span><span class="post-meta-item__value" id="busuanzi_value_page_pv"></span></span></div></header><div class="post-body">
        <h2 id="键入网址再按下回车，发生了什么？"   >
          <a href="#键入网址再按下回车，发生了什么？" class="heading-link"><i class="fas fa-link"></i></a><a href="#键入网址再按下回车，发生了什么？" class="headerlink" title="键入网址再按下回车，发生了什么？"></a>键入网址再按下回车，发生了什么？</h2>
      
        <h3 id="使用-IP-地址访问-Web-服务器"   >
          <a href="#使用-IP-地址访问-Web-服务器" class="heading-link"><i class="fas fa-link"></i></a><a href="#使用-IP-地址访问-Web-服务器" class="headerlink" title="使用 IP 地址访问 Web 服务器"></a>使用 IP 地址访问 Web 服务器</h3>
      <ol>
<li>浏览器从地址栏的输入中获得服务器的IP 地址和端口号；</li>
<li>浏览器用 TCP 的三次握手与服务器建立连接；<a id="more"></a></li>
<li>浏览器向服务器发送拼好的报文；</li>
<li>服务器收到报文后处理请求，同样拼好报文再发给浏览器；</li>
<li>浏览器解析报文，渲染输出页面。</li>
</ol>

        <h3 id="使用域名访问-Web-服务器"   >
          <a href="#使用域名访问-Web-服务器" class="heading-link"><i class="fas fa-link"></i></a><a href="#使用域名访问-Web-服务器" class="headerlink" title="使用域名访问 Web 服务器"></a>使用域名访问 Web 服务器</h3>
      <p>首先会经过DNS解析，浏览器首先看一下自己的缓存里有没有，如果没有就向操作系统的缓存要，还没有就检查本机域名解析文件 hosts，也就是 hosts 文件，windows为“C:\WINDOWS\system32\drivers\etc\hosts”。</p>
<p>DNS解析流程：</p>
<p>先查浏览器缓存，然后是系统缓存-＞hosts文件-＞局域网域名服务器-＞广域网域名服务器-＞顶级域名服务器-＞根域名服务器。</p>

        <h3 id="http-报文"   >
          <a href="#http-报文" class="heading-link"><i class="fas fa-link"></i></a><a href="#http-报文" class="headerlink" title="http 报文"></a>http 报文</h3>
      <p>HTTP 协议在规范文档里详细定义了报文的格式，规定了组成部分，解析规则，还有处理策略，所以可以在 TCP/IP 层之上实现更灵活丰富的功能，例如连接控制，缓存管理、数据编码、内容协商等等。</p>

        <h4 id="报文结构"   >
          <a href="#报文结构" class="heading-link"><i class="fas fa-link"></i></a><a href="#报文结构" class="headerlink" title="报文结构"></a>报文结构</h4>
      <p>TCP 报文来看，它在实际要传输的数据之前附加了一个 20 字节的头部数据，存储 TCP 协议必须的额外信息，例如发送方的端口号、接收方的端口号、包序号、标志位等等。</p>
<p>有了这个附加的 TCP 头，数据包才能够正确传输，到了目的地后把头部去掉，就可以拿到真正的数据。</p>
<img src="/images/http/gk/tcp-header.webp" art="http-header" width="500px">

<p>HTTP 协议也是与 TCP/UDP 类似，同样也需要在实际传输的数据前附加一些头数据，不过与 TCP/UDP 不同的是，它是一个“纯文本”的协议，所以头数据都是 ASCII 码的文本，可以很容易地用肉眼阅读，不用借助程序解析也能够看懂。</p>
<p>HTTP 协议的请求报文和响应报文的结构基本相同，由三大部分组成：</p>
<ol>
<li>起始行（start line）：描述请求或响应的基本信息；</li>
<li>头部字段集合（header）：使用 key-value 形式更详细地说明报文；</li>
<li>消息正文（entity）：实际传输的数据，它不一定是纯文本，可以是图片、视频等二进制数据。</li>
</ol>
<p>这其中前两部分起始行和头部字段经常又合称为“请求头”或“响应头”，消息正文又称为“实体”，但与“header”对应，很多时候就直接称为“body”。</p>
<p>HTTP 协议规定报文必须有 header，但可以没有 body，而且在 header 之后必须要有一个“空行”，也就是“CRLF”，十六进制的“0D0A”。</p>
<p>所以，一个完整的 HTTP 报文就像是下图的这个样子，注意在 header 和 body 之间有一个“空行”。</p>
<img src="/images/http/gk/http-header.webp" art="http-header" width="500px">

<p>http header头</p>
<img src="/images/http/gk/http-header-code.webp" art="http-header" width="500px">

<p>第一行“GET / HTTP/1.1”就是请求行，而后面的“Host”“Connection”等等都属于 header，报文的最后是一个空白行结束，没有 body。</p>

        <h5 id="请求行"   >
          <a href="#请求行" class="heading-link"><i class="fas fa-link"></i></a><a href="#请求行" class="headerlink" title="请求行"></a>请求行</h5>
      <p>请求行由三部分构成：</p>
<ol>
<li>请求方法：是一个动词，如 GET/POST，表示对资源的操作；</li>
<li>请求目标：通常是一个 URI，标记了请求方法要操作的资源；</li>
<li>版本号：表示报文使用的 HTTP 协议版本。</li>
</ol>
<p>这三个部分通常使用空格（space）来分隔，最后要用 CRLF 换行表示结束。</p>
<img src="/images/http/gk/request-line.webp" art="http-header" width="500px">

<figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F; HTTP&#x2F;1.1</span><br></pre></td></tr></table></div></figure>
<p>在这个请求行里，“GET”是请求方法，“/”是请求目标，“HTTP/1.1”是版本号，把这三部分连起来，意思就是“服务器你好，我想获取网站根目录下的默认文件，我用的协议版本号是 1.1，请不要用 1.0 或者 2.0 回复我。”</p>

        <h5 id="状态行"   >
          <a href="#状态行" class="heading-link"><i class="fas fa-link"></i></a><a href="#状态行" class="headerlink" title="状态行"></a>状态行</h5>
      <p>意思是服务器响应的状态。</p>
<p>状态行也是由三部分构成:</p>
<ol>
<li>版本号：表示报文使用的 HTTP 协议版本；</li>
<li>状态码：一个三位数，用代码的形式表示处理的结果，比如 200 是成功，500 是服务器错误；</li>
<li>原因：作为数字状态码补充，是更详细的解释文字，帮助人理解原因。</li>
</ol>
<img src="/images/http/gk/status-line.webp" art="status-line" width="500px">

<figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HTTP&#x2F;1.1 200 OK</span><br></pre></td></tr></table></div></figure>
<p>意思就是：“请求完成，这个报文使用的协议版本号是 1.1，状态码是 200，一切 OK。”</p>

        <h5 id="头部字段"   >
          <a href="#头部字段" class="heading-link"><i class="fas fa-link"></i></a><a href="#头部字段" class="headerlink" title="头部字段"></a>头部字段</h5>
      <p>请求行或状态行再加上头部字段集合就构成了 HTTP 报文里完整的请求头或响应头</p>
<p>如图：</p>
<img src="/images/http/gk/request-h.webp" art="request-h" width="500px">
<img src="/images/http/gk/response-h.webp" art="response-h" width="500px">

<p>请求头和响应头的结构是基本一样的，唯一的区别是起始行，所以我把请求头和响应头里的字段放在一起介绍。</p>
<p>头部字段是 key-value 的形式，key 和 value 之间用“:”分隔，最后用 CRLF 换行表示字段结束。比如在“Host: 127.0.0.1”这一行里 key 就是“Host”，value 就是“127.0.0.1”。</p>
<p>HTTP 头字段非常灵活，不仅可以使用标准里的 Host、Connection 等已有头，也可以任意添加自定义头，这就给 HTTP 协议带来了无限的扩展可能。</p>
<p>不过使用头字段需要注意下面几点：</p>
<ol>
<li>字段名不区分大小写，例如“Host”也可以写成“host”，但首字母大写的可读性更好；</li>
<li>字段名里不允许出现空格，可以使用连字符“-”，但不能使用下划线“_”。例如，“test-name”是合法的字段名，而“test name”“test_name”是不正确的字段名；</li>
<li>字段名后面必须紧接着“:”，不能有空格，而“:”后的字段值前可以有多个空格；</li>
<li>字段的顺序是没有意义的，可以任意排列不影响语义；</li>
<li>字段原则上不能重复，除非这个字段本身的语义允许，例如 Set-Cookie。</li>
</ol>

        <h5 id="常用头字段"   >
          <a href="#常用头字段" class="heading-link"><i class="fas fa-link"></i></a><a href="#常用头字段" class="headerlink" title="常用头字段"></a>常用头字段</h5>
      <p>HTTP 协议规定了非常多的头部字段，实现各种各样的功能，但基本上可以分为四大类：</p>
<ol>
<li>通用字段：在请求头和响应头里都可以出现；</li>
<li>请求字段：仅能出现在请求头里，进一步说明请求信息或者额外的附加条件；</li>
<li>响应字段：仅能出现在响应头里，补充说明响应报文的信息；</li>
<li>实体字段：它实际上属于通用字段，但专门描述 body 的额外信息。</li>
</ol>
<p>首先要说的是 Host 字段，它属于请求字段，只能出现在请求头里，它同时也是唯一一个 HTTP/1.1 规范里要求必须出现的字段，也就是说，如果请求头里没有 Host，那这就是一个错误的报文。</p>

        <h6 id="Host"   >
          <a href="#Host" class="heading-link"><i class="fas fa-link"></i></a><a href="#Host" class="headerlink" title="Host"></a>Host</h6>
      <p>Host 字段告诉服务器这个请求应该由哪个主机来处理，当一台计算机上托管了多个虚拟主机的时候，服务器端就需要用 Host 字段来选择，有点像是一个简单的“路由重定向”。</p>
<p>例如在 127.0.0.1 上有三个虚拟主机：“<span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="http://www.chrono.com”“www.metroid.net”和“origin.io”.那么当使用域名的方式访问时,就必须要用/" >www.chrono.com”“www.metroid.net”和“origin.io”。那么当使用域名的方式访问时，就必须要用</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> Host 字段来区分这三个 IP 相同但域名不同的网站，否则服务器就会找不到合适的虚拟主机，无法处理。</p>

        <h6 id="User-Agent"   >
          <a href="#User-Agent" class="heading-link"><i class="fas fa-link"></i></a><a href="#User-Agent" class="headerlink" title="User-Agent"></a>User-Agent</h6>
      <p>User-Agent 是请求字段，只出现在请求头里。它使用一个字符串来描述发起 HTTP 请求的客户端，服务器可以依据它来返回最合适此浏览器显示的页面。</p>
<p>但由于历史的原因，User-Agent 非常混乱，每个浏览器都自称是“Mozilla”“Chrome”“Safari”，企图使用这个字段来互相“伪装”，导致 User-Agent 变得越来越长，最终变得毫无意义。</p>

        <h6 id="Date"   >
          <a href="#Date" class="heading-link"><i class="fas fa-link"></i></a><a href="#Date" class="headerlink" title="Date"></a>Date</h6>
      <p>Date 字段是一个通用字段，但通常出现在响应头里，表示 HTTP 报文创建的时间，客户端可以使用这个时间再搭配其他字段决定缓存策略。</p>
<p>Server 字段是响应字段，只能出现在响应头里。它告诉客户端当前正在提供 Web 服务的软件名称和版本号，例如在我们的实验环境里它就是“Server: openresty/1.15.8.1”，即使用的是 OpenResty 1.15.8.1。</p>

        <h6 id="Server"   >
          <a href="#Server" class="heading-link"><i class="fas fa-link"></i></a><a href="#Server" class="headerlink" title="Server"></a>Server</h6>
      <p>Server 字段也不是必须要出现的，因为这会把服务器的一部分信息暴露给外界，如果这个版本恰好存在 bug，那么黑客就有可能利用 bug 攻陷服务器。所以，有的网站响应头里要么没有这个字段，要么就给出一个完全无关的描述信息。</p>
<p>比如 GitHub，它的 Server 字段里就看不出是使用了 Apache 还是 Nginx，只是显示为“GitHub.com”。</p>
<img src="/images/http/gk/github-server.webp" art="github-server" width="500px">


        <h6 id="Content-Length"   >
          <a href="#Content-Length" class="heading-link"><i class="fas fa-link"></i></a><a href="#Content-Length" class="headerlink" title="Content-Length"></a>Content-Length</h6>
      <p>Content-Length，它表示报文里 body 的长度，也就是请求头或响应头空行后面数据的长度。服务器看到这个字段，就知道了后续有多少数据，可以直接接收。如果没有这个字段，那么 body 就是不定长的，需要使用 chunked 方式分段传输。</p>

        <h3 id="小结"   >
          <a href="#小结" class="heading-link"><i class="fas fa-link"></i></a><a href="#小结" class="headerlink" title="小结"></a>小结</h3>
      <ol>
<li>HTTP 报文结构由“起始行 + 头部 + 空行 + 实体”组成，简单地说就是“header+body”；2. HTTP 报文可以没有 body，但必须要有 header，而且 header 后也必须要有空行；</li>
<li>请求头由“请求行 + 头部字段”构成，响应头由“状态行 + 头部字段”构成；</li>
<li>请求行有三部分：请求方法，请求目标和版本号；</li>
<li>状态行也有三部分：版本号，状态码和原因字符串；</li>
<li>头部字段是 key-value 的形式，用“:”分隔，不区分大小写，顺序任意，除了规定的标准头，也可以任意添加自定义字段，实现功能扩展；</li>
<li>HTTP/1.1 里唯一要求必须提供的头字段是 Host，它必须出现在请求头里，标记虚拟主机名。</li>
</ol>

        <h2 id="应该如何理解请求方法？"   >
          <a href="#应该如何理解请求方法？" class="heading-link"><i class="fas fa-link"></i></a><a href="#应该如何理解请求方法？" class="headerlink" title="应该如何理解请求方法？"></a>应该如何理解请求方法？</h2>
      
        <h3 id="标准请求方法"   >
          <a href="#标准请求方法" class="heading-link"><i class="fas fa-link"></i></a><a href="#标准请求方法" class="headerlink" title="标准请求方法"></a>标准请求方法</h3>
      <p>目前 HTTP/1.1 规定了八种方法，单词都必须是大写的形式：</p>
<ol>
<li>GET：获取资源，可以理解为读取或者下载数据；</li>
<li>HEAD：获取资源的元信息；</li>
<li>POST：向资源提交数据，相当于写入或上传数据；</li>
<li>PUT：类似 POST；</li>
<li>DELETE：删除资源；</li>
<li>CONNECT：建立特殊的连接隧道；</li>
<li>OPTIONS：列出可对资源实行的方法；</li>
<li>TRACE：追踪请求 - 响应的传输路径。</li>
</ol>

        <h3 id="GET-HEAD"   >
          <a href="#GET-HEAD" class="heading-link"><i class="fas fa-link"></i></a><a href="#GET-HEAD" class="headerlink" title="GET/HEAD"></a>GET/HEAD</h3>
      <p>GET 方法应该是 HTTP 协议里最知名的请求方法了，也应该是用的最多的</p>
<p>它的含义是请求从服务器获取资源，这个资源既可以是静态的文本、页面、图片、视频，也可以是由 PHP、Java 动态生成的页面或者其他格式的数据。</p>
<p>GET 方法虽然基本动作比较简单，但搭配 URI 和其他头字段就能实现对资源更精细的操作。</p>
<p>例如，在 URI 后使用“#”，就可以在获取页面后直接定位到某个标签所在的位置；使用 If-Modified-Since 字段就变成了“有条件的请求”，仅当资源被修改时才会执行获取动作；使用 Range 字段就是“范围请求”，只获取资源的一部分数据。</p>
<p>HEAD 方法与 GET 方法类似，也是请求从服务器获取资源，服务器的处理机制也是一样的，但服务器不会返回请求的实体数据，只会传回响应头，也就是资源的“元信息”。</p>
<p>HEAD 方法可以看做是 GET 方法的一个“简化版”或者“轻量版”。因为它的响应头与 GET 完全相同，所以可以用在很多并不真正需要资源的场合，避免传输 body 数据的浪费。</p>

        <h3 id="POST-PUT"   >
          <a href="#POST-PUT" class="heading-link"><i class="fas fa-link"></i></a><a href="#POST-PUT" class="headerlink" title="POST/PUT"></a>POST/PUT</h3>
      <p>GET 和 HEAD 方法是从服务器获取数据，而 POST 和 PUT 方法则是相反操作，向 URI 指定的资源提交数据，数据就放在报文的 body 里。</p>
<p>POST 也是一个经常用到的请求方法，使用频率应该是仅次于 GET，应用的场景也非常多，只要向服务器发送数据，用的大多数都是 POST。</p>
<p>PUT 的作用与 POST 类似，也可以向服务器提交数据，但与 POST 存在微妙的不同，通常 POST 表示的是“新建”“create”的含义，而 PUT 则是“修改”“update”的含义。</p>
<p>在实际应用中，PUT 用到的比较少。而且，因为它与 POST 的语义、功能太过近似，有的服务器甚至就直接禁止使用 PUT 方法，只用 POST 方法上传数据。</p>
<figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">➜  ~ telnet www.baidu.com 80</span><br><span class="line">Trying 180.101.49.12...</span><br><span class="line">Connected to www.a.shifen.com.</span><br><span class="line">Escape character is &#39;^]&#39;.</span><br><span class="line">POST &#x2F;10-2 HTTP&#x2F;1.1</span><br><span class="line">Host: www.chrono.com</span><br><span class="line">Content-Length: 17</span><br><span class="line"></span><br><span class="line">POST DATA IS HERE</span><br><span class="line"></span><br><span class="line">PUT &#x2F;10-2 HTTP&#x2F;1.1</span><br><span class="line">Host: www.chrono.com</span><br><span class="line">Content-Length: 16</span><br><span class="line"></span><br><span class="line">PUT DATA IS HERE</span><br></pre></td></tr></table></div></figure>

        <h3 id="其他方法"   >
          <a href="#其他方法" class="heading-link"><i class="fas fa-link"></i></a><a href="#其他方法" class="headerlink" title="其他方法"></a>其他方法</h3>
      <ul>
<li>DELETE 方法指示服务器删除资源，因为这个动作危险性太大，所以通常服务器不会执行真正的删除操作，而是对资源做一个删除标记。当然，更多的时候服务器就直接不处理 DELETE 请求。</li>
<li>CONNECT 是一个比较特殊的方法，要求服务器为客户端和另一台远程服务器建立一条特殊的连接隧道，这时 Web 服务器在中间充当了代理的角色。</li>
<li>OPTIONS 方法要求服务器列出可对资源实行的操作方法，在响应头的 Allow 字段里返回。它的功能很有限，用处也不大，有的服务器（例如 Nginx）干脆就没有实现对它的支持。</li>
<li>TRACE 方法多用于对 HTTP 链路的测试或诊断，可以显示出请求 - 响应的传输路径。它的本意是好的，但存在漏洞，会泄漏网站的信息，所以 Web 服务器通常也是禁止使用。</li>
</ul>

        <h3 id="扩展方法"   >
          <a href="#扩展方法" class="heading-link"><i class="fas fa-link"></i></a><a href="#扩展方法" class="headerlink" title="扩展方法"></a>扩展方法</h3>
      <p>虽然 HTTP/1.1 里规定了八种请求方法，但它并没有限制我们只能用这八种方法，这也体现了 HTTP 协议良好的扩展性，我们可以任意添加请求动作，只要请求方和响应方都能理解就行。</p>
<p>此外，还有一些得到了实际应用的请求方法（WebDAV），例如 MKCOL、COPY、MOVE、LOCK、UNLOCK、PATCH 等。</p>

        <h3 id="安全与幂等"   >
          <a href="#安全与幂等" class="heading-link"><i class="fas fa-link"></i></a><a href="#安全与幂等" class="headerlink" title="安全与幂等"></a>安全与幂等</h3>
      <p>安全与幂等。</p>
<p>在 HTTP 协议里，所谓的“安全”是指请求方法不会“破坏”服务器上的资源，即不会对服务器上的资源造成实质的修改。</p>
<p>按照这个定义，只有 GET 和 HEAD 方法是“安全”的，因为它们是“只读”操作，只要服务器不故意曲解请求方法的处理方式，无论 GET 和 HEAD 操作多少次，服务器上的数据都是“安全的”。</p>
<p>而 POST/PUT/DELETE 操作会修改服务器上的资源，增加或删除数据，所以是“不安全”的。</p>
<p>所谓的“幂等”实际上是一个数学用语，被借用到了 HTTP 协议里，意思是多次执行相同的操作，结果也都是相同的，即多次“幂”后结果“相等”。</p>
<p>很显然，GET 和 HEAD 既是安全的也是幂等的，DELETE 可以多次删除同一个资源，效果都是“资源不存在”，所以也是幂等的。</p>
<p>POST 和 PUT 的幂等性质就略费解一点。</p>
<p>按照 RFC 里的语义，POST 是“新增或提交数据”，多次提交数据会创建多个资源，所以不是幂等的；而 PUT 是“替换或更新数据”，多次更新一个资源，资源还是会第一次更新的状态，所以是幂等的。</p>

        <h3 id="小结-1"   >
          <a href="#小结-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#小结-1" class="headerlink" title="小结"></a>小结</h3>
      <ol>
<li>请求方法是客户端发出的、要求服务器执行的、对资源的一种操作；</li>
<li>请求方法是对服务器的“指示”，真正应如何处理由服务器来决定；</li>
<li>最常用的请求方法是 GET 和 POST，分别是获取数据和发送数据；</li>
<li>HEAD 方法是轻量级的 GET，用来获取资源的元信息；</li>
<li>PUT 基本上是 POST 的同义词，多用于更新数据；</li>
<li>“安全”与“幂等”是描述请求方法的两个重要属性，具有理论指导意义，可以帮助我们设计系统。</li>
</ol>

        <h2 id="你能写出正确的网址吗？"   >
          <a href="#你能写出正确的网址吗？" class="heading-link"><i class="fas fa-link"></i></a><a href="#你能写出正确的网址吗？" class="headerlink" title="你能写出正确的网址吗？"></a>你能写出正确的网址吗？</h2>
      <p>URI: 统一资源标识符（Uniform Resource Identifier）</p>
<p>URI 不完全等同于网址，它包含有 URL 和 URN 两个部分，在 HTTP 世界里用的网址实际上是 URL——统一资源定位符（Uniform Resource Locator）。</p>

        <h3 id="URI-的格式"   >
          <a href="#URI-的格式" class="heading-link"><i class="fas fa-link"></i></a><a href="#URI-的格式" class="headerlink" title="URI 的格式"></a>URI 的格式</h3>
      <p>URI 本质上是一个字符串，这个字符串的作用是唯一地标记资源的位置或者名字。</p>
<p>下面的这张图显示了 URI 最常用的形式，由 scheme、host:port、path 和 query 四个部分组成，但有的部分可以视情况省略。</p>
<img src="/images/http/gk/uri-formation.webp" art="uri-formation" width="500px">

<p>URI 第一个组成部分叫 scheme，翻译成中文叫“方案名”或者“协议名”，表示资源应该使用哪种协议来访问。</p>
<p>最常见的当然就是“http”了，表示使用 HTTP 协议。另外还有“https”，表示使用经过加密、安全的 HTTPS 协议。此外还有其他不是很常见的 scheme，例如 ftp、ldap、file、news 等。</p>
<p>在 scheme 之后，必须是三个特定的字符“://”，它把 scheme 和后面的部分分离开。</p>
<p>在“://”之后，是被称为“authority”的部分，表示资源所在的主机名，通常的形式是“host:port”，即主机名加端口号。</p>
<p>主机名可以是 IP 地址或者域名的形式，必须要有，否则浏览器就会找不到服务器。但端口号有时可以省略，浏览器等客户端会依据 scheme 使用默认的端口号，例如 HTTP 的默认端口号是 80，HTTPS 的默认端口号是 443。</p>
<p>有了协议名和主机地址、端口号，再加上后面标记资源所在位置的 path，浏览器就可以连接服务器访问资源了。</p>
<p>URI 里 path 采用了类似文件系统“目录”“路径”的表示方式，因为早期互联网上的计算机多是 UNIX 系统，所以采用了 UNIX 的“/”风格。其实也比较好理解，它与 scheme 后面的“://”是一致的。</p>
<p>URI 的 path 部分必须以“/”开始，也就是必须包含“/”，不要把“/”误认为属于前面 authority。</p>
<figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;nginx.org</span><br><span class="line">http:&#x2F;&#x2F;www.chrono.com:8080&#x2F;11-1</span><br><span class="line">https:&#x2F;&#x2F;tools.ietf.org&#x2F;html&#x2F;rfc7230</span><br><span class="line">file:&#x2F;&#x2F;&#x2F;D:&#x2F;http_study&#x2F;www&#x2F;</span><br></pre></td></tr></table></div></figure>

        <h3 id="URI-的查询参数"   >
          <a href="#URI-的查询参数" class="heading-link"><i class="fas fa-link"></i></a><a href="#URI-的查询参数" class="headerlink" title="URI 的查询参数"></a>URI 的查询参数</h3>
      <p>使用“协议名 + 主机名 + 路径”的方式，已经可以精确定位网络上的任何资源了。但这还不够，很多时候我们还想在操作资源的时候附加一些额外的修饰参数。</p>
<p>如获取商品图片，但想要一个 32×32 的缩略图版本；获取商品列表，但要按某种规则做分页和排序；跳转页面，但想要标记跳转前的原始页面。</p>
<p>仅用“协议名 + 主机名 + 路径”的方式是无法适应这些场景的，所以 URI 后面还有一个“query”部分，它在 path 之后，用一个“?”开始，但不包含“?”，表示对资源附加的额外要求。这是个很形象的符号，比“://”要好的多，很明显地表示了“查询”的含义。</p>
<p>查询参数 query 有一套自己的格式，是多个“key=value”的字符串，这些 KV 值用字符“&amp;”连接，浏览器和服务器都可以按照这个格式把长串的查询参数解析成可理解的字典或关联数组形式。</p>

        <h3 id="URI-的完整格式"   >
          <a href="#URI-的完整格式" class="heading-link"><i class="fas fa-link"></i></a><a href="#URI-的完整格式" class="headerlink" title="URI 的完整格式"></a>URI 的完整格式</h3>
      <p>URI 还有一个“真正”的完整形态，如下图所示。</p>
<img src="/images/http/gk/uri-full-formation.webp" art="uri-formation" width="500px">

<p>这个“真正”形态比基本形态多了两部分。</p>
<p>第一个多出的部分是协议名之后、主机名之前的身份信息“user:passwd@”，表示登录主机时的用户名和密码，但现在已经不推荐使用这种形式了（RFC7230），因为它把敏感信息以明文形式暴露出来，存在严重的安全隐患。</p>
<p>第二个多出的部分是查询参数后的片段标识符“#fragment”，它是 URI 所定位的资源内部的一个“锚点”或者说是“标签”，浏览器可以在获取资源后直接跳转到它指示的位置。</p>
<p>但片段标识符仅能由浏览器这样的客户端使用，服务器是看不到的。也就是说，浏览器永远不会把带“#fragment”的 URI 发送给服务器，服务器也永远不会用这种方式去处理资源的片段。</p>

        <h3 id="URI-的编码"   >
          <a href="#URI-的编码" class="heading-link"><i class="fas fa-link"></i></a><a href="#URI-的编码" class="headerlink" title="URI 的编码"></a>URI 的编码</h3>
      <p>URI 引入了编码机制，对于 ASCII 码以外的字符集和特殊字符做一个特殊的操作，把它们转换成与 URI 语义不冲突的形式。这在 RFC 规范里称为“escape”和“unescape”，俗称“转义”。</p>
<p>URI 转义的规则有点“简单粗暴”，直接把非 ASCII 码或特殊字符转换成十六进制字节值，然后前面再加上一个“%”。</p>
<p>例如，空格被转义成“%20”，“?”被转义成“%3F”。而中文、日文等则通常使用 UTF-8 编码后再转义，例如“银河”会被转义成“%E9%93%B6%E6%B2%B3”。</p>

        <h3 id="小结-2"   >
          <a href="#小结-2" class="heading-link"><i class="fas fa-link"></i></a><a href="#小结-2" class="headerlink" title="小结"></a>小结</h3>
      <ol>
<li>URI 是用来唯一标记服务器上资源的一个字符串，通常也称为 URL；</li>
<li>URI 通常由 scheme、host:port、path 和 query 四个部分组成，有的可以省略；</li>
<li>scheme 叫“方案名”或者“协议名”，表示资源应该使用哪种协议来访问；</li>
<li>“host:port”表示资源所在的主机名和端口号；</li>
<li>path 标记资源所在的位置；</li>
<li>query 表示对资源附加的额外要求；</li>
<li>在 URI 里对“@&amp;/”等特殊字符和汉字必须要做编码，否则服务器收到 HTTP 报文后会无法正确处理。</li>
</ol>

        <h2 id="响应状态码"   >
          <a href="#响应状态码" class="heading-link"><i class="fas fa-link"></i></a><a href="#响应状态码" class="headerlink" title="响应状态码"></a>响应状态码</h2>
      <p>状态行里有用的是中间的状态码（Status Code）了。它是一个十进制数字，以代码的形式表示服务器对请求的处理结果，就像我们通常编写程序时函数返回的错误码一样。</p>

        <h3 id="状态码"   >
          <a href="#状态码" class="heading-link"><i class="fas fa-link"></i></a><a href="#状态码" class="headerlink" title="状态码"></a>状态码</h3>
      <p>RFC 标准把状态码分成了五类，用数字的第一位表示分类，而 0<del>99 不用，这样状态码的实际可用范围就大大缩小了，由 000</del>999 变成了 100~599。</p>
<p>这五类的具体含义是：</p>
<ul>
<li>1××：提示信息，表示目前是协议处理的中间状态，还需要后续的操作；</li>
<li>2××：成功，报文已经收到并被正确处理；</li>
<li>3××：重定向，资源位置发生变动，需要客户端重新发送请求；</li>
<li>4××：客户端错误，请求报文有误，服务器无法处理；</li>
<li>5××：服务器错误，服务器在处理请求时内部发生了错误。</li>
</ul>
<p>目前 RFC 标准里总共有 41 个状态码，但状态码的定义是开放的，允许自行扩展。所以 Apache、Nginx 等 Web 服务器都定义了一些专有的状态码。如果你自己开发 Web 应用，也完全可以在不冲突的前提下定义新的代码。</p>

        <h3 id="1××"   >
          <a href="#1××" class="heading-link"><i class="fas fa-link"></i></a><a href="#1××" class="headerlink" title="1××"></a>1××</h3>
      <p>1××类状态码属于提示信息，是协议处理的中间状态，实际能够用到的时候很少。</p>
<p><strong>101 Switching Protocols</strong> 它的意思是客户端使用 Upgrade 头字段，要求在 HTTP 协议的基础上改成其他的协议继续通信，比如 WebSocket。而如果服务器也同意变更协议，就会发送状态码 101，但这之后的数据传输就不会再使用 HTTP 了。</p>

        <h3 id="2××"   >
          <a href="#2××" class="heading-link"><i class="fas fa-link"></i></a><a href="#2××" class="headerlink" title="2××"></a>2××</h3>
      <p>2××类状态码表示服务器收到并成功处理了客户端的请求</p>
<p><strong>“200 OK”</strong>是最常见的成功状态码，表示一切正常，服务器如客户端所期望的那样返回了处理结果，如果是非 HEAD 请求，通常在响应头后都会有 body 数据。</p>
<p><strong>“204 No Content”</strong>是另一个很常见的成功状态码，它的含义与“200 OK”基本相同，但响应头后没有 body 数据。</p>
<p><strong>“206 Partial Content”</strong>是 HTTP 分块下载或断点续传的基础，在客户端发送“范围请求”、要求获取资源的部分数据时出现，它与 200 一样，也是服务器成功处理了请求，但 body 里的数据不是资源的全部，而是其中的一部分。</p>
<p>状态码 206 通常还会伴随着头字段“Content-Range”，表示响应报文里 body 数据的具体范围，供客户端确认，例如“Content-Range: bytes 0-99/2000”，意思是此次获取的是总计 2000 个字节的前 100 个字节。</p>

        <h3 id="3××"   >
          <a href="#3××" class="heading-link"><i class="fas fa-link"></i></a><a href="#3××" class="headerlink" title="3××"></a>3××</h3>
      <p>3××类状态码表示客户端请求的资源发生了变动，客户端必须用新的 URI 重新发送请求获取资源，也就是通常所说的“重定向”，包括著名的 301、302 跳转。</p>
<p><strong>“301 Moved Permanently”</strong>俗称“永久重定向”，含义是此次请求的资源已经不存在了，需要改用新的 URI 再次访问。</p>
<p>与它类似的是“302 Found”，曾经的描述短语是“Moved Temporarily”，俗称“临时重定向”，意思是请求的资源还在，但需要暂时用另一个 URI 来访问。</p>
<p>301 和 302 都会在响应头里使用字段 Location 指明后续要跳转的 URI，最终的效果很相似，浏览器都会重定向到新的 URI。两者的根本区别在于语义，一个是“永久”，一个是“临时”</p>
<p><strong>“304 Not Modified”</strong>是一个比较有意思的状态码，它用于 If-Modified-Since 等条件请求，表示资源未修改，用于缓存控制。它不具有通常的跳转含义，但可以理解成“重定向已到缓存的文件”（即“缓存重定向”）。</p>

        <h3 id="4××"   >
          <a href="#4××" class="heading-link"><i class="fas fa-link"></i></a><a href="#4××" class="headerlink" title="4××"></a>4××</h3>
      <p>4××类状态码表示客户端发送的请求报文有误，服务器无法处理，它就是真正的“错误码”含义了。</p>
<p><strong>“400 Bad Request”</strong>是一个通用的错误码，表示请求报文有错误</p>
<p><strong>“403 Forbidden”</strong>实际上不是客户端的请求出错，而是表示服务器禁止访问资源。</p>
<p><strong>“404 Not Found”</strong>它的原意是资源在本服务器上未找到，所以无法提供给客户端。</p>
<p>4××里还有一些开发中其他常用的：</p>
<ul>
<li>405 Method Not Allowed：不允许使用某些方法操作资源，例如不允许 POST 只能 GET</li>
<li>406 Not Acceptable：资源无法满足客户端请求的条件，例如请求中文但只有英文</li>
<li>408 Request Timeout：请求超时，服务器等待了过长的时间</li>
<li>409 Conflict：多个请求发生了冲突，可以理解为多线程并发时的竞态</li>
<li>413 Request Entity Too Large：请求报文里的 body 太大</li>
<li>414 Request-URI Too Long：请求行里的 URI 太大</li>
<li>429 Too Many Requests：客户端发送了太多的请求，通常是由于服务器的限连策略</li>
<li>431 Request Header Fields Too Large：请求头某个字段或总体太大</li>
</ul>

        <h3 id="5××"   >
          <a href="#5××" class="heading-link"><i class="fas fa-link"></i></a><a href="#5××" class="headerlink" title="5××"></a>5××</h3>
      <p>5××类状态码表示客户端请求报文正确，但服务器在处理时内部发生了错误，无法返回应有的响应数据，是服务器端的“错误码”。</p>
<p><strong>“500 Internal Server Error”</strong>与 400 类似，也是一个通用的错误码</p>
<p><strong>“501 Not Implemented”</strong>表示客户端请求的功能还不支持</p>
<p><strong>“502 Bad Gateway”</strong>通常是服务器作为网关或者代理时返回的错误码，表示服务器自身工作正常，访问后端服务器时发生了错误</p>
<p><strong>“503 Service Unavailable”</strong>表示服务器当前很忙，暂时无法响应服务，我们上网时有时候遇到的“网络服务正忙，请稍后重试”的提示信息就是状态码 503。</p>
<p>503 是一个“临时”的状态，很可能过几秒钟后服务器就不那么忙了，可以继续提供服务，所以 503 响应报文里通常还会有一个“Retry-After”字段，指示客户端可以在多久以后再次尝试发送请求。</p>

        <h3 id="小结-3"   >
          <a href="#小结-3" class="heading-link"><i class="fas fa-link"></i></a><a href="#小结-3" class="headerlink" title="小结"></a>小结</h3>
      <ol>
<li>状态码在响应报文里表示了服务器对请求的处理结果；</li>
<li>状态码后的原因短语是简单的文字描述，可以自定义；</li>
<li>状态码是十进制的三位数，分为五类，从 100 到 599；2××类状态码表示成功，常用的有 200、204、206；</li>
<li>3××类状态码表示重定向，常用的有 301、302、304；</li>
<li>4××类状态码表示客户端错误，常用的有 400、403、404；</li>
<li>5××类状态码表示服务器错误，常用的有 500、501、502、503。</li>
</ol>

        <h2 id="HTTP有哪些特点？"   >
          <a href="#HTTP有哪些特点？" class="heading-link"><i class="fas fa-link"></i></a><a href="#HTTP有哪些特点？" class="headerlink" title="HTTP有哪些特点？"></a>HTTP有哪些特点？</h2>
      
        <h3 id="灵活可扩展"   >
          <a href="#灵活可扩展" class="heading-link"><i class="fas fa-link"></i></a><a href="#灵活可扩展" class="headerlink" title="灵活可扩展"></a>灵活可扩展</h3>
      <p>HTTP 协议是一个“灵活可扩展”的传输协议。</p>

        <h3 id="可靠传输"   >
          <a href="#可靠传输" class="heading-link"><i class="fas fa-link"></i></a><a href="#可靠传输" class="headerlink" title="可靠传输"></a>可靠传输</h3>
      <p>HTTP 协议是一个“可靠”的传输协议</p>

        <h3 id="应用层协议"   >
          <a href="#应用层协议" class="heading-link"><i class="fas fa-link"></i></a><a href="#应用层协议" class="headerlink" title="应用层协议"></a>应用层协议</h3>
      <p>HTTP 协议是一个应用层的协议</p>

        <h3 id="请求-应答"   >
          <a href="#请求-应答" class="heading-link"><i class="fas fa-link"></i></a><a href="#请求-应答" class="headerlink" title="请求 - 应答"></a>请求 - 应答</h3>
      <p>HTTP 协议使用的是请求 - 应答通信模式</p>

        <h3 id="无状态"   >
          <a href="#无状态" class="heading-link"><i class="fas fa-link"></i></a><a href="#无状态" class="headerlink" title="无状态"></a>无状态</h3>
      <p>HTTP 协议是无状态的</p>
<p>其他特点除了以上的五大特点，其实 HTTP 协议还可以列出非常多的特点，例如传输的实体数据可缓存可压缩、可分段获取数据、支持身份认证、支持国际化语言等。但这些并不能算是 HTTP 的基本特点，因为这都是由第一个“灵活可扩展”的特点所衍生出来的。</p>

        <h3 id="http缺点"   >
          <a href="#http缺点" class="heading-link"><i class="fas fa-link"></i></a><a href="#http缺点" class="headerlink" title="http缺点"></a>http缺点</h3>
      
        <h4 id="明文"   >
          <a href="#明文" class="heading-link"><i class="fas fa-link"></i></a><a href="#明文" class="headerlink" title="明文"></a>明文</h4>
      <p>HTTP 协议里还有一把优缺点一体的“双刃剑”，就是明文传输。</p>
<p>“明文”意思就是协议里的报文（准确地说是 header 部分）不使用二进制数据，而是用简单可阅读的文本形式。</p>

        <h4 id="不安全"   >
          <a href="#不安全" class="heading-link"><i class="fas fa-link"></i></a><a href="#不安全" class="headerlink" title="不安全"></a>不安全</h4>
      <p>与“明文”缺点相关但不完全等同的另一个缺点是“不安全”。</p>
<p>安全有很多的方面，明文只是“机密”方面的一个缺点，在“身份认证”和“完整性校验”这两方面 HTTP 也是欠缺的。</p>

        <h4 id="性能"   >
          <a href="#性能" class="heading-link"><i class="fas fa-link"></i></a><a href="#性能" class="headerlink" title="性能"></a>性能</h4>
      <p>不算差，不够好</p>

        <h3 id="小结-4"   >
          <a href="#小结-4" class="heading-link"><i class="fas fa-link"></i></a><a href="#小结-4" class="headerlink" title="小结"></a>小结</h3>
      <ol>
<li>HTTP 是灵活可扩展的，可以任意添加头字段实现任意功能；</li>
<li>HTTP 是可靠传输协议，基于 TCP/IP 协议“尽量”保证数据的送达；</li>
<li>HTTP 是应用层协议，比 FTP、SSH 等更通用功能更多，能够传输任意数据；</li>
<li>HTTP 使用了请求 - 应答模式，客户端主动发起请求，服务器被动回复请求；</li>
<li>HTTP 本质上是无状态的，每个请求都是互相独立、毫无关联的，协议不要求客户端或服务器记录请求相关的信息。</li>
<li>HTTP 是无状态的，可以轻松实现集群化，扩展性能，但有时也需要用 Cookie 技术来实现“有状态”；</li>
<li>HTTP 是明文传输，数据完全肉眼可见，能够方便地研究分析，但也容易被窃听；HTTP 是不安全的，无法验证通信双方的身份，也不能判断报文是否被窜改；</li>
<li>HTTP 的性能不算差，但不完全适应现在的互联网，还有很大的提升空间。</li>
</ol>

        <h2 id="课程来源"   >
          <a href="#课程来源" class="heading-link"><i class="fas fa-link"></i></a><a href="#课程来源" class="headerlink" title="课程来源"></a>课程来源</h2>
      <p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://time.geekbang.org/column/intro/100029001" >https://time.geekbang.org/column/intro/100029001</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
<p>欢迎大家订购，一块儿学习，共同进步。</p>
</div><footer class="post-footer"><div class="post-ending ending"><div class="ending__text">------ END ------</div></div><div class="post-tags"><span class="post-tags-item"><span class="post-tags-item__icon"><i class="fas fa-tag"></i></span><a class="post-tags-item__link" href="http://example.com/tags/http/">http</a></span><span class="post-tags-item"><span class="post-tags-item__icon"><i class="fas fa-tag"></i></span><a class="post-tags-item__link" href="http://example.com/tags/TCP-IP/">TCP/IP</a></span></div><nav class="post-paginator paginator"><div class="paginator-next"><a class="paginator-next__link" href="/2021/07/03/%E9%A2%84%E6%B5%8B%E6%80%A7%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1/"><span class="paginator-prev__text">预测性负载均衡</span><span class="paginator-next__icon"><i class="fas fa-angle-right"></i></span></a></div></nav></footer></div></div></div><div class="sidebar-wrap" id="sidebar-wrap"><aside class="sidebar" id="sidebar"><div class="sidebar-nav"><span class="sidebar-nav-toc current">Catalog</span><span class="sidebar-nav-ov">Overview</span></div><section class="sidebar-toc"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%94%AE%E5%85%A5%E7%BD%91%E5%9D%80%E5%86%8D%E6%8C%89%E4%B8%8B%E5%9B%9E%E8%BD%A6%EF%BC%8C%E5%8F%91%E7%94%9F%E4%BA%86%E4%BB%80%E4%B9%88%EF%BC%9F"><span class="toc-number">1.</span> <span class="toc-text">
          键入网址再按下回车，发生了什么？</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-IP-%E5%9C%B0%E5%9D%80%E8%AE%BF%E9%97%AE-Web-%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-number">1.1.</span> <span class="toc-text">
          使用 IP 地址访问 Web 服务器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%9F%9F%E5%90%8D%E8%AE%BF%E9%97%AE-Web-%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-number">1.2.</span> <span class="toc-text">
          使用域名访问 Web 服务器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#http-%E6%8A%A5%E6%96%87"><span class="toc-number">1.3.</span> <span class="toc-text">
          http 报文</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8A%A5%E6%96%87%E7%BB%93%E6%9E%84"><span class="toc-number">1.3.1.</span> <span class="toc-text">
          报文结构</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%B7%E6%B1%82%E8%A1%8C"><span class="toc-number">1.3.1.1.</span> <span class="toc-text">
          请求行</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%8A%B6%E6%80%81%E8%A1%8C"><span class="toc-number">1.3.1.2.</span> <span class="toc-text">
          状态行</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%A4%B4%E9%83%A8%E5%AD%97%E6%AE%B5"><span class="toc-number">1.3.1.3.</span> <span class="toc-text">
          头部字段</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%A4%B4%E5%AD%97%E6%AE%B5"><span class="toc-number">1.3.1.4.</span> <span class="toc-text">
          常用头字段</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#Host"><span class="toc-number">1.3.1.4.1.</span> <span class="toc-text">
          Host</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#User-Agent"><span class="toc-number">1.3.1.4.2.</span> <span class="toc-text">
          User-Agent</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Date"><span class="toc-number">1.3.1.4.3.</span> <span class="toc-text">
          Date</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Server"><span class="toc-number">1.3.1.4.4.</span> <span class="toc-text">
          Server</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#Content-Length"><span class="toc-number">1.3.1.4.5.</span> <span class="toc-text">
          Content-Length</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%8F%E7%BB%93"><span class="toc-number">1.4.</span> <span class="toc-text">
          小结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BA%94%E8%AF%A5%E5%A6%82%E4%BD%95%E7%90%86%E8%A7%A3%E8%AF%B7%E6%B1%82%E6%96%B9%E6%B3%95%EF%BC%9F"><span class="toc-number">2.</span> <span class="toc-text">
          应该如何理解请求方法？</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%87%E5%87%86%E8%AF%B7%E6%B1%82%E6%96%B9%E6%B3%95"><span class="toc-number">2.1.</span> <span class="toc-text">
          标准请求方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#GET-HEAD"><span class="toc-number">2.2.</span> <span class="toc-text">
          GET&#x2F;HEAD</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#POST-PUT"><span class="toc-number">2.3.</span> <span class="toc-text">
          POST&#x2F;PUT</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E6%96%B9%E6%B3%95"><span class="toc-number">2.4.</span> <span class="toc-text">
          其他方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%A9%E5%B1%95%E6%96%B9%E6%B3%95"><span class="toc-number">2.5.</span> <span class="toc-text">
          扩展方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E5%85%A8%E4%B8%8E%E5%B9%82%E7%AD%89"><span class="toc-number">2.6.</span> <span class="toc-text">
          安全与幂等</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%8F%E7%BB%93-1"><span class="toc-number">2.7.</span> <span class="toc-text">
          小结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%A0%E8%83%BD%E5%86%99%E5%87%BA%E6%AD%A3%E7%A1%AE%E7%9A%84%E7%BD%91%E5%9D%80%E5%90%97%EF%BC%9F"><span class="toc-number">3.</span> <span class="toc-text">
          你能写出正确的网址吗？</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#URI-%E7%9A%84%E6%A0%BC%E5%BC%8F"><span class="toc-number">3.1.</span> <span class="toc-text">
          URI 的格式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#URI-%E7%9A%84%E6%9F%A5%E8%AF%A2%E5%8F%82%E6%95%B0"><span class="toc-number">3.2.</span> <span class="toc-text">
          URI 的查询参数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#URI-%E7%9A%84%E5%AE%8C%E6%95%B4%E6%A0%BC%E5%BC%8F"><span class="toc-number">3.3.</span> <span class="toc-text">
          URI 的完整格式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#URI-%E7%9A%84%E7%BC%96%E7%A0%81"><span class="toc-number">3.4.</span> <span class="toc-text">
          URI 的编码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%8F%E7%BB%93-2"><span class="toc-number">3.5.</span> <span class="toc-text">
          小结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%93%8D%E5%BA%94%E7%8A%B6%E6%80%81%E7%A0%81"><span class="toc-number">4.</span> <span class="toc-text">
          响应状态码</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%8A%B6%E6%80%81%E7%A0%81"><span class="toc-number">4.1.</span> <span class="toc-text">
          状态码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1%C3%97%C3%97"><span class="toc-number">4.2.</span> <span class="toc-text">
          1××</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%C3%97%C3%97"><span class="toc-number">4.3.</span> <span class="toc-text">
          2××</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%C3%97%C3%97"><span class="toc-number">4.4.</span> <span class="toc-text">
          3××</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%C3%97%C3%97"><span class="toc-number">4.5.</span> <span class="toc-text">
          4××</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5%C3%97%C3%97"><span class="toc-number">4.6.</span> <span class="toc-text">
          5××</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%8F%E7%BB%93-3"><span class="toc-number">4.7.</span> <span class="toc-text">
          小结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HTTP%E6%9C%89%E5%93%AA%E4%BA%9B%E7%89%B9%E7%82%B9%EF%BC%9F"><span class="toc-number">5.</span> <span class="toc-text">
          HTTP有哪些特点？</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%81%B5%E6%B4%BB%E5%8F%AF%E6%89%A9%E5%B1%95"><span class="toc-number">5.1.</span> <span class="toc-text">
          灵活可扩展</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%AF%E9%9D%A0%E4%BC%A0%E8%BE%93"><span class="toc-number">5.2.</span> <span class="toc-text">
          可靠传输</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E5%B1%82%E5%8D%8F%E8%AE%AE"><span class="toc-number">5.3.</span> <span class="toc-text">
          应用层协议</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%B7%E6%B1%82-%E5%BA%94%E7%AD%94"><span class="toc-number">5.4.</span> <span class="toc-text">
          请求 - 应答</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%A0%E7%8A%B6%E6%80%81"><span class="toc-number">5.5.</span> <span class="toc-text">
          无状态</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#http%E7%BC%BA%E7%82%B9"><span class="toc-number">5.6.</span> <span class="toc-text">
          http缺点</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%98%8E%E6%96%87"><span class="toc-number">5.6.1.</span> <span class="toc-text">
          明文</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%8D%E5%AE%89%E5%85%A8"><span class="toc-number">5.6.2.</span> <span class="toc-text">
          不安全</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%80%A7%E8%83%BD"><span class="toc-number">5.6.3.</span> <span class="toc-text">
          性能</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%8F%E7%BB%93-4"><span class="toc-number">5.7.</span> <span class="toc-text">
          小结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%BE%E7%A8%8B%E6%9D%A5%E6%BA%90"><span class="toc-number">6.</span> <span class="toc-text">
          课程来源</span></a></li></ol></section><!-- ov = overview--><section class="sidebar-ov hide"><div class="sidebar-ov-author"><div class="sidebar-ov-author__avatar"><img class="sidebar-ov-author__avatar_img" src="/images/icons/stun-logo.svg" alt="avatar"></div><p class="sidebar-ov-author__text">hello world</p></div><div class="sidebar-ov-state"><a class="sidebar-ov-state-item sidebar-ov-state-item--posts" href="/archives/"><div class="sidebar-ov-state-item__count">20</div><div class="sidebar-ov-state-item__name">Archives</div></a><a class="sidebar-ov-state-item sidebar-ov-state-item--categories" href="/categories/"><div class="sidebar-ov-state-item__count">10</div><div class="sidebar-ov-state-item__name">Categories</div></a><a class="sidebar-ov-state-item sidebar-ov-state-item--tags" href="/tags/"><div class="sidebar-ov-state-item__count">21</div><div class="sidebar-ov-state-item__name">Tags</div></a></div></section><div class="sidebar-reading"><div class="sidebar-reading-info"><span class="sidebar-reading-info__text">You have read </span><span class="sidebar-reading-info__num">0</span><span class="sidebar-reading-info__perc">%</span></div><div class="sidebar-reading-line"></div></div></aside></div><div class="clearfix"></div></div></main><footer class="footer" id="footer"><div class="footer-inner"><div><span>Copyright © 2021</span><span class="footer__icon"><i class="fas fa-heart"></i></span><span>lucky</span></div><div class="busuanzi"><span class="busuanzi-siteuv"><span class="busuanzi-siteuv__icon"><i class="fas fa-user"></i></span><span class="busuanzi-siteuv__info">Visitors</span><span class="busuanzi-siteuv__value" id="busuanzi_value_site_uv"></span></span><span class="busuanzi-sitepv"><span class="busuanzi-siteuv__icon"><i class="fas fa-eye"></i></span><span class="busuanzi-siteuv__info">Views</span><span class="busuanzi-siteuv__value" id="busuanzi_value_site_pv"></span></span></div><div><a href="https://github.com/luckylsx/" rel="noopener" target="_blank">Github Pages</a></div></div></footer><div class="loading-bar" id="loading-bar"><div class="loading-bar__progress"></div></div><div class="back2top" id="back2top"><span class="back2top__icon"><i class="fas fa-rocket"></i></span></div></div><div class="search-mask"></div><div class="search-popup"><span class="search-close"></span><div class="search-input"><input placeholder="Search for Posts (Support multiple keywords)"><div class="search-btns">Search by:<span class="search-btns-item search-btns-item--google"><i class="fab fa-google"></i>Google</span><span class="search-btns-item search-btns-item--bing"><i></i>Bing</span><span class="search-btns-item search-btns-item--baidu"><i></i>Baidu</span></div></div><div class="search-results"></div></div><script src="https://cdn.jsdelivr.net/npm/jquery@v3.4.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.2/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.2/velocity.ui.min.js"></script><script>function initSearch() {
  var isXML = true;
  var search_path = 'search.json';

  if (!search_path) {
    search_path = 'search.xml';
  } else if (/json$/i.test(search_path)) {
    isXML = false;
  }

  var path = '/' + search_path;
  $.ajax({
    url: path,
    dataType: isXML ? 'xml' : 'json',
    async: true,
    success: function (res) {
      var datas = isXML ? $('entry', res).map(function () {
        // 将 XML 转为 JSON
        return {
          title: $('title', this).text(),
          content: $('content', this).text(),
          url: $('url', this).text()
        };
      }).get() : res;
      var $input = $('.search-input input');
      var $result = $('.search-results');
      // 搜索对象（标题、内容）的权重，影响显示顺序
      var WEIGHT = { title: 100, content: 1 };
      var searchPost = function () {
        var searchText = $input.val().toLowerCase().trim();
        // 根据空白字符分隔关键字
        var keywords = searchText.split(/[\s]+/);
        // 搜索结果
        var matchPosts = [];

        // 有多个关键字时，将原文字整个保存下来
        if (keywords.length > 1) {
          keywords.push(searchText);
        }
        // 防止未输入字符时搜索
        if (searchText.length > 0) {
          datas.forEach(function (data) {
            var isMatch  = false;
            // 没有标题的文章使用预设的 i18n 变量代替
            var title = (data.title && data.title.trim()) || '[ Untitled ]';
            var titleLower = title && title.toLowerCase();
            // 删除 HTML 标签 和 所有空白字符
            var content = data.content && data.content.replace(/<[^>]+>/g, '');
            var contentLower = content && content.toLowerCase();
            // 删除重复的 /
            var postURL = data.url && decodeURI(data.url).replace(/\/{2,}/g, '/');
            // 标题中匹配到的关键词
            var titleHitSlice = [];
            // 内容中匹配到的关键词
            var contentHitSlice = [];

            keywords.forEach(function (keyword) {
              /**
              * 获取匹配的关键词的索引
              * @param {String} keyword 要匹配的关键字
              * @param {String} text 原文字
              * @param {Boolean} caseSensitive 是否区分大小写
              * @param {Number} weight 匹配对象的权重。权重大的优先显示
              * @return {Array}
              */
              function getIndexByword (word, text, caseSensitive, weight) {
                if (!word || !text) {
                  return [];
                };

                var startIndex = 0; // 每次匹配的开始索引
                var index = -1;     // 匹配到的索引值
                var result = [];    // 匹配结果

                if (!caseSensitive) {
                  word = word.toLowerCase();
                  text = text.toLowerCase();
                }

                while((index = text.indexOf(word, startIndex)) !== -1) {
                  var hasMatch = false;
                  // 索引位置相同的关键词，保留长度较长的
                  titleHitSlice.forEach(function (hit) {
                    if (hit.index === index && hit.word.length < word.length) {
                      hit.word = word;
                      hasMatch = true;
                    }
                  });
                  startIndex = index + word.length;
                  !hasMatch && result.push({ index: index, word: word, weight: weight });
                }
                return result;
              }
              titleHitSlice = titleHitSlice.concat(getIndexByword(keyword, titleLower, false, WEIGHT.title));
              contentHitSlice = contentHitSlice.concat(getIndexByword(keyword, contentLower, false, WEIGHT.content));
            });

            var hitTitle = titleHitSlice.length;
            var hitContent = contentHitSlice.length;

            if (hitTitle > 0 || hitContent > 0) {
              isMatch = true;
            }
            if (isMatch) {
              ;[titleHitSlice, contentHitSlice].forEach(function (hit) {
                // 按照匹配文字的索引的递增顺序排序
                hit.sort(function (left, right) {
                  return left.index - right.index;
                });
              });
              /**
              * 给文本中匹配到的关键词添加标记，从而进行高亮显示
              * @param {String} text 原文本
              * @param {Array} hitSlice 匹配项的索引信息
              * @param {Number} start 开始索引
              * @param {Number} end 结束索引
              * @return {String}
              */
              function highlightKeyword (text, hitSlice, start, end) {
                if (!text || !hitSlice || !hitSlice.length) {
                  return;
                }

                var result = '';
                var startIndex = start;
                var endIndex = end;
                hitSlice.forEach(function (hit) {
                  if (hit.index < startIndex) {
                    return;
                  }

                  var hitWordEnd = hit.index + hit.word.length;
                  result += text.slice(startIndex, hit.index);
                  result += '<b>' + text.slice(hit.index, hitWordEnd) + '</b>';
                  startIndex = hitWordEnd;
                });
                result += text.slice(startIndex, endIndex);
                return result;
              }

              var postData = {};
              // 文章总的搜索权重
              var postWeight = titleHitSlice.length * WEIGHT.title + contentHitSlice.length * WEIGHT.content;
              // 标记匹配关键词后的标题
              var postTitle = highlightKeyword(title, titleHitSlice, 0, title.length) || title;
              // 标记匹配关键词后的内容
              var postContent;
              // 显示内容的长度
              var SHOW_WORD_LENGTH = 200;
              // 命中关键词前的字符显示长度
              var SHOW_WORD_FRONT_LENGTH = 20;
              var SHOW_WORD_END_LENGTH = SHOW_WORD_LENGTH - SHOW_WORD_FRONT_LENGTH;

              // 截取匹配的第一个字符，前后共 200 个字符来显示
              if (contentHitSlice.length > 0) {
                var firstIndex = contentHitSlice[0].index;
                var start = firstIndex > SHOW_WORD_FRONT_LENGTH ? firstIndex - SHOW_WORD_FRONT_LENGTH : 0;
                var end = firstIndex + SHOW_WORD_END_LENGTH;
                postContent = highlightKeyword(content, contentHitSlice, start, end);
              } else { // 未匹配到内容，直接截取前 200 个字符来显示
                postContent = content.slice(0, SHOW_WORD_LENGTH);
              }
              postData.title = postTitle;
              postData.content = postContent;
              postData.url = postURL;
              postData.weight = postWeight;
              matchPosts.push(postData);
            }
          });
        }

        var resultInnerHtml = '';
        if (matchPosts.length) {
          // 按权重递增的顺序排序，使权重大的优先显示
          matchPosts.sort(function (left, right) {
            return right.weight - left.weight;
          });
          resultInnerHtml += '<ul>';
          matchPosts.forEach(function (post) {
            resultInnerHtml += '<li><a class="search-results-title" href="' + post.url + '">';
            resultInnerHtml += post.title;
            resultInnerHtml += '</a><div class="search-results-content">';
            resultInnerHtml += post.content;
            resultInnerHtml += '</div></li>';
          });
          resultInnerHtml += '</ul>';
        } else {
          resultInnerHtml += '<div class="search-results-none"><i class="far fa-meh"></i></div>';
        }
        $result.html(resultInnerHtml);
      };
      $input.on('input', searchPost);
      $input.on('keyup', function (e) {
        if (e.keyCode === Stun.utils.codeToKeyCode('Enter')) {
          searchPost();
        }
      });
    }
  });
}

function closeSearch () {
  $('body').css({ overflow: 'auto' });
  $('.search-popup').css({ display: 'none' });
  $('.search-mask').css({ display: 'none' });
}

window.addEventListener('DOMContentLoaded', function () {
  Stun.utils.pjaxReloadLocalSearch = function () {
    $('.header-nav-search').on('click', function (e) {
      e.stopPropagation();
      $('body').css('overflow', 'hidden');
      $('.search-popup')
        .velocity('stop')
        .velocity('transition.expandIn', {
          duration: 300,
          complete: function () {
            $('.search-popup input').focus();
          }
        });
      $('.search-mask')
        .velocity('stop')
        .velocity('transition.fadeIn', {
          duration: 300
        });

      initSearch();
    });
    $('.search-mask, .search-close').on('click', function () {
      closeSearch();
    });
    $(document).on('keydown', function (e) {
      // Escape <=> 27
      if (e.keyCode === Stun.utils.codeToKeyCode('Escape')) {
        closeSearch();
      }
    });
  };

  Stun.utils.pjaxReloadLocalSearch();
}, false);

function safeOpenUrl(url) {
  var newTab = window.open();
  newTab.opener = null;
  newTab.location = url;
}

function extSearch(engine) {
  var engines = {
    google: 'https://www.google.com/search?q=',
    bing: 'https://cn.bing.com/search?q=',
    baidu: 'https://www.baidu.com/s?ie=UTF-8&wd=',
  };
  var host = window.location.host;
  var query = $('.search-input input').val().toLowerCase().trim();
  var uri = engines[engine] + query + ' site:' + host;

  if (query) {
    safeOpenUrl(uri);
  } else {
    Stun.utils.popAlert('warning', 'Please enter characters');
  }
}

var assistSearchList = window.CONFIG.assistSearch;

if (Array.isArray(assistSearchList)) {
  assistSearchList.forEach(function (name) {
    document.querySelector('.search-btns-item--' + name).addEventListener('click', function () {
      extSearch(name);
    }, false);
  });
}</script><script src="https://cdn.jsdelivr.net/gh/sukkaw/busuanzi@latest/bsz.pure.mini.js" async></script><script src="/js/utils.js?v=2.6.2"></script><script src="/js/stun-boot.js?v=2.6.2"></script><script src="/js/scroll.js?v=2.6.2"></script><script src="/js/header.js?v=2.6.2"></script><script src="/js/sidebar.js?v=2.6.2"></script><script type="application/json" src="/search.json"></script></body></html>